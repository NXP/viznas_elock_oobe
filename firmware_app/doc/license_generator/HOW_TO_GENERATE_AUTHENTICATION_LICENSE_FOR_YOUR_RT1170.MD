# Introduction

Prior to running, our algorithm performs an authentication check to ensure the algorithm will be running on verified silicon (e.x. RT117F) rather than a generic/unauthorized part (e.x. RT1170). Authentication will be performed, and the algorithm will only run normally if the authentication was successful.

Generally, authentication is performed by validating boot fuses which indicate things like the chip's HW ID.However, for early stage software enablement and algorithm verification before authenticated silicon is made available, license-based authentication is provided as an alternative means of testing. The following sections will describe how to use license-based authentication with the RT1170 EVK/RTVN3.

**The flow to generate and install a license for the RT1170 is as follows:**

1. Erase your board's flash and flash the license generator firmware "license_generator_0x30000000.bin" to your board at flash address 0x30000000.

   Note: Use "license_generator_vizn3_0x30000000.bin" firmware for your VIZN3 board with RT1170 chip.

2. Use the license generator firmware flashed in the previous step to generate a license for your board.

3. Send the license generated by the generator firmware running on your RT1170 to dongsheng.zhang@nxp.com. Dongsheng will generate a license binary file "rt_licenses_0x30f00000" using the license retrieved in the previous step which can be flashed to your board for authentication of the device.

4. Flash the "rt_licenses_0x30f00000.bin" into your board's flash at address 0x30f00000.

5. Flash smart_lock_117F (or other) firmware. Board will be successfully authenticated using the license binary flashed in the previous step.

This flow will be described in greater detail in the following sections.

# How to generator the license for your board

## Environment settings (recommended)

1. JLink version V6.88c with the RT1170 SEGGER updates from "nxp_rt1170_b0_segger_v0.5.zip." See [sln_app/smart_lock_rt117f/README.md](https://bitbucket.sw.nxp.com/projects/MISS/repos/sln_app/browse/smart_lock_rt117f) for more information.

2. RT1170 EVK REV C board

## Step 1:   Erase flash and flash the license generator firmware "license_generator_0x30000000.bin"

> **!!!!!Make sure SW1 is to set to "0 0 0 0"!!!!!**

Connect the J-Link and execute the below commands:

```shell
connect           // initiate connection to device
MIMXRT1776XXXA_M7 // set device to "MIMXRT1176XXXA_M7"
s                 // Specify the "SWD" interface
<Enter>           // use default interface speed
erase             // erase the flash
loadbin /PATH/TO/GENERATOR/BIN/license_generator_0x30000000.bin 0x30000000 // flash fw into address 0x30000000
```

The whole shell log for reference:

```shell
zds@zds-dev:/opt/SEGGER/JLink$ ./JLinkExe
SEGGER J-Link Commander V6.88c (Compiled Dec  4 2020 19:04:45)
DLL version V6.88c, compiled Dec  4 2020 19:04:32

Connecting to J-Link via USB...O.K.
Firmware: J-Link Ultra V4 compiled Jan  4 2021 16:16:50
Hardware version: V4.00
S/N: 504501196
License(s): RDI, FlashBP, FlashDL, JFlash, GDB
VTref=3.326V

Type "connect" to establish a target connection, '?' for help
J-Link>connect
Please specify device / core. <Default>: MIMXRT1176XXXA_M7
Type '?' for selection dialog
Device>
Please specify target interface:
 J) JTAG (Default)
 S) SWD
 T) cJTAG
TIF>S
Specify target interface speed [kHz]. <Default>: 4000 kHz
Speed>
Device "MIMXRT1176XXXA_M7" selected.

Connecting to target via SWD
Found SW-DP with ID 0x6BA02477
DPIDR: 0x6BA02477
Scanning AP map to find all available APs
AP[3]: Stopped AP scan as end of AP map has been reached
AP[0]: AHB-AP (IDR: 0x84770001)
AP[1]: AHB-AP (IDR: 0x24770011)
AP[2]: APB-AP (IDR: 0x54770002)
Iterating through AP map to find AHB-AP to use
AP[0]: Core found
AP[0]: AHB-AP ROM base: 0xE00FD000
CPUID register: 0x411FC272. Implementer code: 0x41 (ARM)
Found Cortex-M7 r1p2, Little endian.
FPUnit: 8 code (BP) slots and 0 literal slots
CoreSight components:
ROMTbl[0] @ E00FD000
ROMTbl[0][0]: E00FE000, CID: B105100D, PID: 000BB4C8 ROM Table
ROMTbl[1] @ E00FE000
ROMTbl[1][0]: E00FF000, CID: B105100D, PID: 000BB4C7 ROM Table
ROMTbl[2] @ E00FF000
ROMTbl[2][0]: E000E000, CID: B105E00D, PID: 000BB00C SCS-M7
ROMTbl[2][1]: E0001000, CID: B105E00D, PID: 000BB002 DWT
ROMTbl[2][2]: E0002000, CID: B105E00D, PID: 000BB00E FPB-M7
ROMTbl[2][3]: E0000000, CID: B105E00D, PID: 000BB001 ITM
ROMTbl[1][1]: E0041000, CID: B105900D, PID: 001BB975 ETM-M7
ROMTbl[1][2]: E0042000, CID: B105900D, PID: 004BB906 CTI
ROMTbl[0][1]: E0043000, CID: B105900D, PID: 001BB908 CSTF
Cache: Separate I- and D-cache.
I-Cache L1: 32 KB, 512 Sets, 32 Bytes/Line, 2-Way
D-Cache L1: 32 KB, 256 Sets, 32 Bytes/Line, 4-Way
Cortex-M7 identified.
J-Link>erase
Without any give address range, Erase Chip will be executed
Erasing device...
J-Link: Flash download: Total time needed: 37.831s (Prepare: 0.102s, Compare: 0.000s, Erase: 37.725s, Program: 0.000s, Verify: 0.000s, Restore: 0.002s)
Erasing done.
J-Link>loadbin /home/zds/trunk/license_generator_0x30000000 0x30000000
Downloading file [/home/zds/trunk/license_generator_0x30000000]...
File is of unknown / supported format.
J-Link>loadbin /home/zds/trunk/license_generator_0x30000000.bin 0x30000000
Downloading file [/home/zds/trunk/license_generator_0x30000000.bin]...
J-Link: Flash download: Bank 0 @ 0x30000000: 1 range affected (65536 bytes)
J-Link: Flash download: Total: 0.536s (Prepare: 0.004s, Compare: 0.178s, Erase: 0.000s, Program & Verify: 0.225s, Restore: 0.127s)
J-Link: Flash download: Program & Verify speed: 284 KB/s
O.K.
J-Link>exit
zds@zds-dev:/opt/SEGGER/JLink$
```

## Step 2: Launch the license generator firmware and generate a license

> **Power off the board and !!!!!Make sure SW1 is set to "0 0 1 0" (set SW1's switch 3 to ON)!!!!!**

Connect a micro-USB cable from your host computer to **J11** on your RT1170 EVK and power on/reset the board.

After powering on the board, connect to the board's shell terminal using a tty tool (TeraTerm, PuTTY, minicom, etc.) on your host computer. Using **minicom** on Ubuntu, the command to open the terminal is:

```shell
sudo minicom -D /dev/ttyACM0
```

Connecting to the terminal will display a prompt like the following:

> "Press any key to generate the license"

Afterwards, press any key in the terminal to generate the license and print it in the terminal as shown below:

```shell
>>RT LICENSE GENERATOR>>
0x79797979 0x79797979 0x79797979 0x79797979
0x00006cc6 0x000032c4 0x000074fd 0x00101850
0x00004bf7 0x00005a91 0x00002d0b 0x00001060
0x004028b0 0x00005bd9 0x00007a60 0x00007f23
0x00005064 0x00003583 0x00003287 0x0000407f
0x00006c00 0x00002b82 0x000054ea 0x0000793e
0x00001a10 0x00046cbd 0x00801a99 0x00001ce1
0x00000e90 0x00082bc1 0x00105f88 0x0000042a
0x00005493 0x00085629 0x00006357 0x00016067
0x00000d96 0x001056c9 0x00001e33 0x000017a0
0x00004aa1 0x00000e9d 0x00002544 0x000054c0
0x00005b23 0x00007074 0x00005af7 0x00005a63
0x00002d8b 0x00002b5c 0x000066e6 0x00005fe4
0x00001da6 0x00080fcc 0x000031a5 0x00000903
0x00004cbb 0x00001b14 0x00006037 0x00004198
0x00005f68 0x00405885 0x00000b4b 0x00002a1a
0x00003d3b 0x000079f0 0x00042e35 0x000000ee
0x00002610 0x0000647f 0x000001b1 0x00003471
0x0000712d 0x40000dc5 0x00007656 0x000009c4
0x00002a1e 0x00005d47 0x000062db 0x0000445a
0x00003f51 0x00007db7 0x00007a0d 0x00007a43
0x00000672 0x00004594 0x00002c8c 0x00002135
0x00005a84 0x00002e14 0x00001a49 0x0000205f
0x000077c4 0x000072cc 0x000017bf 0x000012ee
0x0000393e 0x000057a5 0x00004af4 0x0000275b
0x0000142c 0x0000367f 0x00001c2f 0x0000077b
0x00006d12 0x00004422 0x00007676 0x00007545
0x0000229a 0x000036e9 0x000013ce 0x00000860
0x00006a2f 0x00004229 0x00005131 0x00003874
0x00005a5c 0x00007d72 0x0001464f 0x0000412d
0x00003ee3 0x00004644 0x00001d05 0x0004250f
0x0000129d 0x0000362f 0x0000649e 0x00006fdd
0x00003b15 0x00003e91 0x00005ccc 0x00006287
0x12121212 0x12121212 0x12121212 0x12121212
<<RT LICENSE GENERATOR<<
```

## Step 3: Build the license binary file

Send the license for your board generated in the previous step to dongsheng.zhang@nxp.com who will build the license binary for you. Dongsheng will usually send back the license binary file "rt_licenses_0x30f00000.bin" within one workday.

## Step 4: Flash the license binary "rt_licenses_0x30f00000.bin" file into your board's flash @0x30f00000

> **Power off the board and !!!!!Make sure the SW1 to set to "0 0 1 0" (SW1's switch 3 set to ON)!!!!!**

Same procedure as Step 1, but this time, flash the binary file "rt_licenses_0x30f00000.bin" returned by Dongsheng to address 0x30f00000 by using the command:

```shell
loadbin /PATH/TO/BIN/rt_licenses_0x30f00000.bin 0x30f00000
```

Re-download and launch the smart_lock_rt117f project, and face detection should now work.
